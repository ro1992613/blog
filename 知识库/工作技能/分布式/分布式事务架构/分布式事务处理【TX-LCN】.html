<!DOCTYPE html> <html><head>
<title>分布式事务处理【TX-LCN】</title>
<base href="../../../..">
<meta id="root-path" root-path="../../../..">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
<meta charset="UTF-8">
<meta name="description" content="笔记 - 分布式事务处理【TX-LCN】">
<meta property="og:title" content="分布式事务处理【TX-LCN】">
<meta property="og:description" content="笔记 - 分布式事务处理【TX-LCN】">
<meta property="og:type" content="website">
<meta property="og:url" content="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html">
<meta property="og:image" content="attachments/e20b04926c2ed678323ee8a91bad5f77_md5.png">
<meta property="og:site_name" content="笔记">
<script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6):has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(const t of e){let e=t.getAttribute("src");try{const o=await fetch(e);if(!o.ok){console.log("Could not include file: "+e),t?.remove();continue}let l=await o.text(),n=document.createRange().createContextualFragment(l),c=Array.from(n.children);for(let e of c)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);t.before(n),t.remove(),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon trim-cols row-lines col-lines table-lines row-hover minimal-notion-light minimal-dracula-dark minimal-readable colorful-headings links-int-on links-ext-on full-width-media is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><div class="search-input-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="分布式事务处理【TX-LCN】"><p dir="auto">分布式事务处理【TX-LCN】</p></h1><div class="heading-wrapper"><h2 data-heading="[分布式事务](https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020)框架 TX-LCN" dir="auto" class="heading" id="[分布式事务](https//so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020)框架_TX-LCN"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><a data-tooltip-position="top" aria-label="https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020" rel="noopener" class="external-link is-unresolved" href="https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020" target="_self">分布式事务</a>框架 TX-LCN</h2><div class="heading-children"><div><p dir="auto">主要内容</p></div><div><ol dir="auto">
<li data-line="0" dir="auto">分布式事务</li>
<li data-line="1" dir="auto">分布式事务理论依据</li>
<li data-line="2" dir="auto">TX-LCN 概述</li>
<li data-line="3" dir="auto">TX-LCN 事务模式</li>
<li data-line="4" dir="auto">XA 的两阶段提交方案</li>
<li data-line="5" dir="auto">TxManager 搭建</li>
<li data-line="6" dir="auto">基于 Spring Cloud 的 TX-LCN</li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="一、 分布式事务" dir="auto" class="heading" id="一、_分布式事务"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>一、 分布式事务</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="1 分布式事务是什么？" dir="auto" class="heading" id="1_分布式事务是什么？"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 分布式事务是什么？</h3><div class="heading-children"><div><p dir="auto">在<a data-tooltip-position="top" aria-label="https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F&amp;spm=1001.2101.3001.7020" rel="noopener" class="external-link is-unresolved" href="https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F&amp;spm=1001.2101.3001.7020" target="_self">分布式系统</a>中，<code>事务参与者在不同的分布式节点上或事务操作的数据源不是同一个</code>，这些情况产生的事务都叫做分布式事务。</p></div><div><p dir="auto">例如：<br>
项目 A 实现 Tb_item 表新增、项目 B 实现tb_item_param 新增，现在需要实现商品新增，需要把项目 A 和项目 B 两个项目新增的方法组成一个事务，这个事务就是分布式事务。</p></div><div><p dir="auto">例如：项目中向 MySQL 做添加，同时还需要向 Redis 或 MongoDB 添加，希望在出现异常情况时执行 MySQL 或 Redis 或 MongoDB，这种情况也应用的情况。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="2 什么时候使用假冒业务" dir="auto" class="heading" id="2_什么时候使用假冒业务"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 什么时候使用假冒业务</h3><div class="heading-children"><div><p dir="auto">事务的概念最早是在学习数据库（MySQL、Oracle）中接触到的，一个事务（本地事务）就是一系列 SQL 语句的集合，只要在执行过程中一条 SQL 出错就会导致整个事务失败，回滚到原点。而在分布式系统中存在多模块完成一次业务。那么就存在一个业务由多模块操作同一个数据源。<br>
<span alt="e20b04926c2ed678323ee8a91bad5f77_MD5.png" src="e20b04926c2ed678323ee8a91bad5f77_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="e20b04926c2ed678323ee8a91bad5f77_MD5.png" src="attachments/e20b04926c2ed678323ee8a91bad5f77_md5.png" target="_self"></span></p></div><div><p dir="auto">甚至可能存在一个业务横跨多种数据源节点的可能。这些问题都可以由分布式事务解决方案 TX-LCN 解决。<br>
<span alt="4146abdd7b7cf46b4b226011c8c86be6_MD5.png" src="4146abdd7b7cf46b4b226011c8c86be6_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="4146abdd7b7cf46b4b226011c8c86be6_MD5.png" src="attachments/4146abdd7b7cf46b4b226011c8c86be6_md5.png" target="_self"></span></p></div></div></div><div class="heading-wrapper"><h3 data-heading="3 分布式事务常见解决方案" dir="auto" class="heading" id="3_分布式事务常见解决方案"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3 分布式事务常见解决方案</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="3.1基于 XA 协议的两阶段提交" dir="auto" class="heading" id="3.1基于_XA_协议的两阶段提交"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1基于 XA 协议的两阶段提交</h4><div class="heading-children"><div><p dir="auto">分布式事务通常采用 2PC 协议，全称 Two Phase Commitment Protocol。该协议主要为了解决在分布式数据库场景下，所有节点间数据一致性的问题。分布式事务通过 2PC 协议将提交分成两个阶段：</p></div><div><ol dir="auto">
<li data-line="0" dir="auto">prepare</li>
<li data-line="1" dir="auto">commit/rollback</li>
</ol></div><div><p dir="auto">阶段一为准备（prepare）阶段。即所有的参与者准备执行事务并锁住需要的资源。参与者 ready 时，向 transaction manager 报告已准备就绪。</p></div><div><p dir="auto">阶段二为提交阶段（commit）。当 transaction manager 确认所有参与者都 ready 后，向所有参与者发送 commit 命令。</p></div></div></div><div class="heading-wrapper"><h4 data-heading="3.2消息事务+最终一致性" dir="auto" class="heading" id="3.2消息事务+最终一致性"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2消息事务+最终一致性</h4><div class="heading-children"><div><p dir="auto">所谓的消息事务就是基于消息中间件的两阶段提交，本质上是对消息中间件的一种特殊利用，它是将本地事务和发消息放在了一个分布式事务里，保证要么本地操作成功并且对外发消息成功，要么两者都失败。</p></div><div><p dir="auto">分布式事务，本质上是对多个数据库的事务进行统一控制，按照控制力度可以分为：不控制、部分控制和完全控制。不控制就是不引入分布式事务，部分控制就是各 种变种的两阶段提交，包括上面提到的 消息事务+最终一致性、TCC 模式，而完全控制就是完全实现两阶段提交。部分控制的好处是并发量和性能很好，缺点是数据一致性减弱了，完全控制则是牺牲了性能，保障了一致性，具体用哪种方式，最终还是取决于业务场景。</p></div></div></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="二、 分布式事务理论依据" dir="auto" class="heading" id="二、_分布式事务理论依据"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>二、 分布式事务理论依据</h2><div class="heading-children"><div><p dir="auto">分布式事务存在两大理论依据：CAP 定理和 BASE 理论。</p></div><div class="heading-wrapper"><h3 data-heading="1 CAP 定理" dir="auto" class="heading" id="1_CAP_定理"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 CAP 定理</h3><div class="heading-children"><div><p dir="auto">CAP 定理是指在一个分布式系统中Consistency(一致性)、Availability(可用性)、Partitiontolerance(分区容错性)，最多同时满足其中两个，三者不可兼得。</p></div><div class="heading-wrapper"><h4 data-heading="1.1一致性（C）" dir="auto" class="heading" id="1.1一致性（C）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.1一致性（C）</h4><div class="heading-children"><div><p dir="auto">在分布式系统中所有节点的状态是一样的。</p></div></div></div><div class="heading-wrapper"><h4 data-heading="1.2可用性（A）" dir="auto" class="heading" id="1.2可用性（A）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.2可用性（A）</h4><div class="heading-children"><div><p dir="auto">在集群中一部分节点出现故障后，整个集群是否还能响应客户端请求。</p></div></div></div><div class="heading-wrapper"><h4 data-heading="1.3分区容错性（P）" dir="auto" class="heading" id="1.3分区容错性（P）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3分区容错性（P）</h4><div class="heading-children"><div><p dir="auto">以实际效果而言，分区相当于对操作的时限要求。如果系统不能在一定时限内达到数据一致性，就意味着发生了分区的情况，此时就必须在 A 和 C 中做选择。</p></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="2 BASE 理论" dir="auto" class="heading" id="2_BASE_理论"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 BASE 理论</h3><div class="heading-children"><div><p dir="auto">是指 Basically Available（基本可用）、Soft state（软状态）和 Eventually consistent（最终一致性）三个短语的缩写。<br>
BASE 理论是对 CAP 中一致性和可用性权衡的结果，是基于 CAP 演化而来的。</p></div><div><p dir="auto">BASE 理论核心思想：即使无法做到强一致性，每个应用都可以根据自身业务特点，采用适当的方式达到最终一致性。</p></div><div class="heading-wrapper"><h4 data-heading="2.1基本可用（BA）" dir="auto" class="heading" id="2.1基本可用（BA）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1基本可用（BA）</h4><div class="heading-children"><div><p dir="auto">是指在分布式系统中出现不可知故障的时候，允许损失部分可用性。此处要注意：损失部分可用性，不代表整个系统不可用。<br>
例如：</p></div><div><ol dir="auto">
<li data-line="0" dir="auto">可以增加响应时间。由之前 0.5 秒，在出现故障的时候变成 1~2 秒。</li>
<li data-line="1" dir="auto">由于一些特殊原因，使网站访问流量激增，为了保证整个系统的稳定性，部分访问者可能被引导到降级页面中。</li>
</ol></div></div></div><div class="heading-wrapper"><h4 data-heading="2.2软状态（S）" dir="auto" class="heading" id="2.2软状态（S）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2软状态（S）</h4><div class="heading-children"><div><p dir="auto">是指系统中数据允许存在中间状态（软状态），并认为这个状态是不影响系统的可用性的。通俗解释：允许分布式节点之间存在同步延迟。<br>
例如：<br>
在 Eureka 集群中数据同步时就存在软状态。</p></div></div></div><div class="heading-wrapper"><h4 data-heading="2.3最终一致性" dir="auto" class="heading" id="2.3最终一致性"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3最终一致性</h4><div class="heading-children"><div><p dir="auto">允许整个系统中数据在经过一定时间后，最终能达到整个系统的一致性。但是这个时间绝对不可以过长。</p></div><div><p dir="auto">强一致性要求系统接收请求后，整个系统必须达到一致性效果，才会响应结果。</p></div><div><p dir="auto">最终一致性是弱一致性的特例。满足最终一致性的系统在响应给用户结果时整个系统可能是没有达到一致性的，但是最终一定会达到一致性效果的。</p></div></div></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="三、 TX-LCN 概述" dir="auto" class="heading" id="三、_TX-LCN_概述"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>三、 TX-LCN 概述</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="1 简介" dir="auto" class="heading" id="1_简介"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 简介</h3><div class="heading-children"><div><p dir="auto">LCN 框架在 2017 年 6 月发布第一个版本，目前最新已经达到 5.0 版本。<br>
LCN 早期设计时，1.0 版本和 2.0 版本设计步骤如下：<br>
1）锁定事务单元（Lock）<br>
2）确认事务模块状态（Confirm）<br>
3）通知事务（<a data-tooltip-position="top" aria-label="https://so.csdn.net/so/search?q=Notify&amp;spm=1001.2101.3001.7020" rel="noopener" class="external-link is-unresolved" href="https://so.csdn.net/so/search?q=Notify&amp;spm=1001.2101.3001.7020" target="_self">Notify</a>）</p></div><div><p dir="auto">取各自首字母后名称为 LCN。<br>
LCN 框架从 5.0 开始兼容了 LCN、TCC、TXC 三种事务模式，为了和 LCN 框架区分，从5.0 开始把 LCN 框架更名为：TX-LCN 分布式事务框架。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="2 TX-LCN 原理" dir="auto" class="heading" id="2_TX-LCN_原理"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 TX-LCN 原理</h3><div class="heading-children"><div><p dir="auto">TX-LCN 由两大模块组成，TxClient、TxManager。<br>
TxClient 作为模块的依赖框架，提供了 TX-LCN 的标准支持，事务发起方和参与方都属于TxClient。TxManager 作为分布式事务的控制方，控制整个事务。<br>
<span alt="7e0a3ef593bc3a8b3911aa1385b1120b_MD5.png" src="7e0a3ef593bc3a8b3911aa1385b1120b_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="7e0a3ef593bc3a8b3911aa1385b1120b_MD5.png" src="attachments/7e0a3ef593bc3a8b3911aa1385b1120b_md5.png" target="_self"></span></p></div><div class="heading-wrapper"><h4 data-heading="2.1原理中核心内容" dir="auto" class="heading" id="2.1原理中核心内容"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1原理中核心内容</h4><div class="heading-children"><div class="heading-wrapper"><h5 data-heading="2.1.1 创建事务组" dir="auto" class="heading" id="2.1.1_创建事务组"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.1 创建事务组</h5><div class="heading-children"><div><p dir="auto">是指在事务发起方开始执行业务代码之前先调用 TxManager 创建事务组对象，然后拿到事务标识 GroupId 的过程。</p></div></div></div><div class="heading-wrapper"><h5 data-heading="2.1.2 加入事务组" dir="auto" class="heading" id="2.1.2_加入事务组"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.2 加入事务组</h5><div class="heading-children"><div><p dir="auto">添加事务组是指参与方在执行完业务方法以后，将该模块的事务信息通知给 TxManager 的操作。</p></div></div></div><div class="heading-wrapper"><h5 data-heading="2.1.3 通知事务组" dir="auto" class="heading" id="2.1.3_通知事务组"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.3 通知事务组</h5><div class="heading-children"><div><p dir="auto">是 指 在 发 起 方 执 行 完 业 务 代 码 以 后 ， 将 发 起 方 执 行 结 果 状 态 通 知 给TxManager,TxManager 将根据事务最终状态和事务组的信息来通知相应的参与模块提交或回滚事务，并返回结果给事务发起方。</p></div></div></div></div></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="四、 TX-LCN 事务模式" dir="auto" class="heading" id="四、_TX-LCN_事务模式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>四、 TX-LCN 事务模式</h2><div class="heading-children"><div><p dir="auto">Tx-LCN 5.0 开始支持三种事务模式，分别是：LCN、TCC、TXC 模式。<br>
每种模式在实际使用时有着自己对应的注解。</p></div><div><pre dir="auto"><code>`LCN：@LcnTransaction
TCC：@TccTransaction
TXC：@TxcTransaction` 

</code><button class="copy-code-button">复制</button></pre></div><div class="heading-wrapper"><h3 data-heading="1 LCN 模式" dir="auto" class="heading" id="1_LCN_模式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 LCN 模式</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="1.1原理介绍" dir="auto" class="heading" id="1.1原理介绍"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.1原理介绍</h4><div class="heading-children"><div><p dir="auto">LCN 模式是通过代理 JDBC 中 Connection 的方式实现对本地事务的操作，然后在由TxManager 统一协调控制事务。当本地事务提交回滚或者关闭连接时将会执行假操作，该代理的连接将由 LCN 连接池管理。</p></div></div></div><div class="heading-wrapper"><h4 data-heading="1.2模式特点" dir="auto" class="heading" id="1.2模式特点"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.2模式特点</h4><div class="heading-children"><div><ul dir="auto">
<li data-line="0" dir="auto">该模式对代码的嵌入性低。</li>
<li data-line="1" dir="auto">该模式仅限于本地存在连接对象且可通过连接对象控制事务的模块。</li>
<li data-line="2" dir="auto">该模式下的事务提交与回滚是由本地事务方控制，对于数据一致性上有较高的保障。</li>
<li data-line="3" dir="auto">该模式缺陷在于代理的连接需要随事务发起方一同释放连接，增加了连接占用的时间。</li>
</ul></div><div><p dir="auto"><strong>总结：LCN 模式适合能用 JDBC 连接的所有支持事务的数据库。</strong> </p></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="2 TCC 事务模式" dir="auto" class="heading" id="2_TCC_事务模式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 TCC 事务模式</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="2.1原理介绍" dir="auto" class="heading" id="2.1原理介绍"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1原理介绍</h4><div class="heading-children"><div><p dir="auto">TCC 事务机制相对于传统事务机制（X/Open XA Two-Phase-Commit），其特征在于它不依赖资源管理器(RM)对 XA 的支持，而是通过对（由业务系统提供的）业务逻辑的调度来实现分布式事务。主要由三步操作，Try: 尝试执行业务、 Confirm:确认执行业务、 Cancel: 取消执行业务。</p></div></div></div><div class="heading-wrapper"><h4 data-heading="2.2代码说明" dir="auto" class="heading" id="2.2代码说明"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2代码说明</h4><div class="heading-children"><div><p dir="auto">每个 TCC 事务处理方法可以额外包含 confirmXxx 和 cancelXxx 的方法（），出现失败问题，需要在 cancel 中通过业务逻辑把改变的数据还原回来。</p></div><div><pre dir="auto"><code>`confirmXxx 和 cancelXxx 两个方法会由 TxManager 进行统一协调调用。
confirmXxx 和 cancelXxx 也可以在@TccTransaction 注解中通过属性明确指定。` 

</code><button class="copy-code-button">复制</button></pre></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@TccTransaction</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 正常的 service 方法，也是 Try 尝试执行执行</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirmDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 当 demo 方法没有出现异常时执行的方法</span>
	<span class="token comment">// 方法名称必须叫做 confirm+代理方法首字母</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancelDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 当 demo 方法出现异常时执行的方法</span>
	<span class="token comment">// 方法名称必须叫做 cancel+代理方法首字母</span>
<span class="token punctuation">}</span>` 


</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="2.3模式特点" dir="auto" class="heading" id="2.3模式特点"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3模式特点</h4><div class="heading-children"><div><ul dir="auto">
<li data-line="0" dir="auto">该模式对代码的嵌入性高，要求每个业务需要写二个以上步骤的操作。</li>
<li data-line="1" dir="auto">该模式对有无本地事务控制都可以支持，使用面更广。</li>
<li data-line="2" dir="auto">数据一致性控制几乎完全由开发者控制，对业务开发难度要求高。</li>
</ul></div><div><p dir="auto">总结：Tcc 模式应用于所有不支持 XA 事务的软件。例如：redis，mongodb 等。</p></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="3 TXC 事务模式" dir="auto" class="heading" id="3_TXC_事务模式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3 TXC 事务模式</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="3.1原理介绍" dir="auto" class="heading" id="3.1原理介绍"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1原理介绍</h4><div class="heading-children"><div><p dir="auto">TXC 模式命名来源于淘宝，实现原理是在执行 SQL 之前，先查询 SQL 的影响数据，然后保存执行的 SQL 信息和创建锁。当需要回滚的时候就采用这些记录数据回滚数据库，目前锁实现依赖 redis 分布式锁控制。（在使用 lcn 时必须要配置 redis 参数）</p></div></div></div><div class="heading-wrapper"><h4 data-heading="3.2模式特点" dir="auto" class="heading" id="3.2模式特点"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2模式特点</h4><div class="heading-children"><div><ul dir="auto">
<li data-line="0" dir="auto">该模式同样对代码的嵌入性低。</li>
<li data-line="1" dir="auto">该模式仅限于对支持 SQL 方式的模块支持。</li>
<li data-line="2" dir="auto">该模式由于每次执行 SQL 之前需要先查询影响数据，因此相比 LCN 模式消耗资源与时间要多。</li>
<li data-line="3" dir="auto">该模式不会占用数据库的连接资源。</li>
</ul></div><div><p dir="auto"><strong>总结：只能用在支持 SQL 的数据库。对资源消耗较多。建议使用 LCN 模式</strong></p></div></div></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="五、 XA 的两阶段提交方案（数据库支持分布式事务，为什么还用TX-LCN）" dir="auto" class="heading" id="五、_XA_的两阶段提交方案（数据库支持分布式事务，为什么还用TX-LCN）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>五、 XA 的两阶段提交方案（数据库支持分布式事务，为什么还用TX-LCN）</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="1 什么是 XA 协议" dir="auto" class="heading" id="1_什么是_XA_协议"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 什么是 XA 协议</h3><div class="heading-children"><div><p dir="auto">XA 协议由 Oracle Tuxedo 首先提出的，并交给 X/Open 组织，作为资源管理器（数据库）与事务管理器的接口标准。目前，Oracle、Informix、DB2 和 Sybase 等各大数据库厂家都提供对 XA 的支持。XA 协议采用两阶段提交方式来管理分布式事务。XA 接口提供资源管理器与事务管理器之间进行通信的标准接口。</p></div><div><p dir="auto">XA 就是 X/Open DTP 定义的交易中间件与数据库之间的接口规范（即接口函数），交易中间件用它来通知数据库事务的开始、结束以及提交、回滚等。XA 接口函数由数据库厂商提供。</p></div><div><p dir="auto">X/Open 组织（即现在的 Open Group）定义了分布式事务处理模型。X/Open DTP 模型（1994）包括应用程序（AP）、事务管理器（TM）、资源管理器（RM）、通信资源管理器（CRM）四部分。一般，常见的事务管理器（TM）是交易中间件，常见的资源管理器（RM）是数据库，常见的通信资源管理器（CRM）是消息中间件。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="2 XA 协议的一阶段提交" dir="auto" class="heading" id="2_XA_协议的一阶段提交"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 XA 协议的一阶段提交</h3><div class="heading-children"><div><p dir="auto"><span alt="7b8256e7459f68f4e73c9b29c0d49ee4_MD5.png" src="7b8256e7459f68f4e73c9b29c0d49ee4_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="7b8256e7459f68f4e73c9b29c0d49ee4_MD5.png" src="attachments/7b8256e7459f68f4e73c9b29c0d49ee4_md5.png" target="_self"></span></p></div><div><p dir="auto">如果在程序中开启了事务，那么在应用程序发出提交/回滚请求后，数据库执行操作，而后将成功/失败返回给应用程序，程序继续执行。</p></div><div><p dir="auto">一阶段提交协议相对简单。优点也很直观，它不用再与其他的对象交互，节省了判断步骤和时间，所以在性能上是在阶段提交协议中最好的。但缺点也很明显：数据库确认执行事务的时间较长，出问题的可能性就随之增大。如果有多个数据源，一阶段提交协议无法协调他们之间的关系。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="3 XA 协议的二阶段提交" dir="auto" class="heading" id="3_XA_协议的二阶段提交"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3 XA 协议的二阶段提交</h3><div class="heading-children"><div><p dir="auto">在一阶段协议的基础上，有了二阶段协议，二阶段协议的好处是添加了一个管理者角色。<br>
<span alt="8cb99c4b7fad10f77566f525f8dcbbc1_MD5.png" src="8cb99c4b7fad10f77566f525f8dcbbc1_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="8cb99c4b7fad10f77566f525f8dcbbc1_MD5.png" src="attachments/8cb99c4b7fad10f77566f525f8dcbbc1_md5.png" target="_self"></span></p></div><div><p dir="auto">很明显，二阶段协议通过将两层变为三层，增加了中间的管理者角色，从而协调多个数据源之间的关系，二阶段提交协议分为两个阶段。<br>
<span alt="bd2a0e6994a242c11f23cb056963ef3d_MD5.png" src="bd2a0e6994a242c11f23cb056963ef3d_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="bd2a0e6994a242c11f23cb056963ef3d_MD5.png" src="attachments/bd2a0e6994a242c11f23cb056963ef3d_md5.png" target="_self"></span></p></div><div><p dir="auto">应用程序调用了事务管理器的提交方法，此后第一阶段分为两个步骤：<br>
事务管理器通知参与该事务的各个资源管理器，通知他们开始准备事务。<br>
资源管理器接收到消息后开始准备阶段，写好事务日志并执行事务，但不提交，然后将是否就绪的消息返回给事务管理器（此时已经将事务的大部分事情做完，以后的内容耗时极小）。<br>
<span alt="1cfd2d384fedcde751a08d3c00b35a09_MD5.png" src="1cfd2d384fedcde751a08d3c00b35a09_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="1cfd2d384fedcde751a08d3c00b35a09_MD5.png" src="attachments/1cfd2d384fedcde751a08d3c00b35a09_md5.png" target="_self"></span></p></div><div><p dir="auto">第二阶段也分为两个步骤：<br>
事务管理器在接受各个消息后，开始分析，如果有任意其一失败，则发送回滚命令，否则发送提交命令。<br>
各个资源管理器接收到命令后，执行（耗时很少），并将提交消息返回给事务管理器。<br>
事务管理器接受消息后，事务结束，应用程序继续执行。<br>
为什么要分两步执行？一是因为分两步，就有了事务管理器统一管理的机会；二尽可能晚地提交事务，让事务在提交前尽可能地完成所有能完成的工作，这样，最后的提交阶段将是耗时极短，耗时极短意味着操作失败的可能性也就降低。</p></div><div><p dir="auto">同时，二阶段提交协议为了保证事务的一致性，不管是事务管理器还是各个资源管理器，每执行一步操作，都会记录日志，为出现故障后的恢复准备依据。<br>
<strong>缺点：</strong><br>
1 二阶段提交协议的存在的弊端是阻塞，因为事务管理器要收集各个资源管理器的响应消息，如果其中一个或多个一直不返回消息，则事务管理器一直等待，应用程序也被阻塞，甚至可能永久阻塞。</p></div><div><p dir="auto">2 两阶段提交理论的一个广泛工业应用是 XA 协议。目前几乎所有收费的商业数据库都支持 XA 协议。XA 协议已在业界成熟运行数十年，但目前它在互联网海量流量的应用场景中，吞吐量这个瓶颈变得十分致命，因此很少被用到。</p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="六、 TxManager 搭建" dir="auto" class="heading" id="六、_TxManager_搭建"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>六、 TxManager 搭建</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="1 创建项目，添加依赖" dir="auto" class="heading" id="1_创建项目，添加依赖"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 创建项目，添加依赖</h3><div class="heading-children"><div><p dir="auto">新建项目 TxManager，并添加依赖。<br>
依赖包含了 Spring-boot 的依赖，版本是 2.0.5，如果希望把版本改变成 2.2.2 或其他版本只需要添加 spring-boot-starter-parent 继承即可</p></div><div><pre dir="auto" class="language-xml" tabindex="0"><code class="language-xml is-loaded">`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.codingapi.txlcn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>txlcn-tm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.0.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>` 


</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="2 执行 SQL 文件" dir="auto" class="heading" id="2_执行_SQL_文件"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 执行 SQL 文件</h3><div class="heading-children"><div><p dir="auto">执行 tx-manager.sql 文件（在任意的数据库下执行即可）。</p></div><div><p dir="auto">tx-manager.sql</p></div><div><pre dir="auto" class="language-sql" tabindex="0"><code class="language-sql is-loaded"><span class="token identifier"><span class="token punctuation">`</span><span class="token punctuation">`</span></span><span class="token comment">/*
 Navicat Premium Data Transfer

 Source Server         : local
 Source Server Type    : MySQL
 Source Server Version : 100309
 Source Host           : localhost:3306
 Source Schema         : tx-manager

 Target Server Type    : MySQL
 Target Server Version : 100309
 File Encoding         : 65001

 Date: 29/12/2018 18:35:59
*/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span>  <span class="token identifier"><span class="token punctuation">`</span>tx-manager<span class="token punctuation">`</span></span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci<span class="token punctuation">;</span>
<span class="token keyword">USE</span> <span class="token identifier"><span class="token punctuation">`</span>tx-manager<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_tx_exception</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>t_tx_exception<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t_tx_exception<span class="token punctuation">`</span></span>  <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>group_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>unit_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>mod_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>transaction_state<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>registrar<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>ex_state<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'0 待处理 1已处理'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>remark<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10240</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'备注'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">967</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>

<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token identifier"><span class="token punctuation">`</span><span class="token punctuation">`</span></span> 

</code><button class="copy-code-button">复制</button></pre></div><div><p dir="auto">在 MySQL 生成 tx-manager 的数据库，在数据库中新建 t_tx_exception 的表，此表用作存储事务组信息。<br>
注意：<br>
默认情况下 tx-manager 需要记录日志信息的，需要在项目中配置日志连接数据库相关参数，其中日志存储数据库没有要求，可以存储到任意数据库中，当运行后会自动在数据库中生成一个日志表。如果不希望记录日志可以直接设置 <code>tx-lcn.logger.enabled=false</code>，关闭日志功能，下面的日志连接数据库参数也可以不用配置。<br>
在实际案例演示中会把所有的日志记录功能关闭。如果希望记录记录日志需要把下面代码在所有引用 tx-lcn 的项目的配置文件中进行配置。</p></div><div><pre dir="auto" class="language-properties" tabindex="0"><code class="language-properties is-loaded"><span class="token key attr-name">`tx-lcn.logger.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">tx-lcn.logger.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">tx-lcn.logger.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.8.131:3306/tx-mana</span>
<span class="token key attr-name">ger?characterEncoding</span><span class="token punctuation">=</span><span class="token value attr-value">UTF-8</span>
<span class="token key attr-name">tx-lcn.logger.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">tx-lcn.logger.password</span><span class="token punctuation">=</span><span class="token value attr-value">root` </span>


</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="3 配置配置文件" dir="auto" class="heading" id="3_配置配置文件"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3 配置配置文件</h3><div class="heading-children"><div><p dir="auto">在 TxManager 项目的 resource 下新建 application.properties。tx-lcn 在当前版本有个 bug<br>
只能使用 properties 文件，使用 yml 文件会导致配置文件无法被加载的问题。<br>
配置文件中内容上半部分是 tx-manager 数据库的连接信息。中间包含 redis 连接信息（此处连接的是 redis 单机版，端口默认，没有密码），下面是关闭日志记录功能<br>
小提示：<br>
依赖 Redis，所以需要安装 Redis。<br>
7970 是客户端访问端口，是 Txmanager 可视化界面访问端口，此端口任意。<br>
更加详细配置信息可以看 txlcn-tm-5.0.2.RELEASE.zip 中 application.propertie</p></div><div><pre dir="auto" class="language-properties" tabindex="0"><code class="language-properties is-loaded"><span class="token key attr-name">`#</span> <span class="token value attr-value">TM事务管理器的服务端WEB访问端口。提供一个可视化的界面。端口自定义。</span>
<span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">7970</span>

<span class="token comment"># TM事务管理器，需要访问数据库，实现分布式事务状态记录。</span>
<span class="token key attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/tx-manager?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>
<span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>

<span class="token comment"># TM事务管理器，是依赖Redis使用分布式事务协调的。尤其是TCC和TXC两种事务模型。</span>
<span class="token key attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.89.141</span>
<span class="token key attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>
<span class="token key attr-name">spring.redis.database</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>

<span class="token comment"># 为spring应用起名。</span>
<span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">tx-lcn-transaction-manager</span>

<span class="token comment"># TM事务管理器，提供的WEB管理平台的登录密码。无用户名。 默认是codingapi</span>
<span class="token key attr-name">tx-lcn.manager.admin-key</span><span class="token punctuation">=</span><span class="token value attr-value">bjsxt</span>
<span class="token comment"># 日志。如果需要TM记录日志。则开启，赋值为true，并提供后续的配置。</span>
<span class="token key attr-name">tx-lcn.logger.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">false  </span>

<span class="token comment"># 为日志功能，提供数据库连接。和之前配置的分布式事务管理依赖使用的数据源不同。</span>
<span class="token comment"># tx-lcn.logger.driver-class-name=com.mysql.cj.jdbc.Driver</span>
<span class="token comment"># tx-lcn.logger.jdbc-url=jdbc:mysql://localhost:3306/tx-manager?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>
<span class="token comment"># tx-lcn.logger.username=root</span>
<span class="token comment"># tx-lcn.logger.password=root` </span>

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="4 新建启动类" dir="auto" class="heading" id="4_新建启动类"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4 新建启动类</h3><div class="heading-children"><div><p dir="auto">注意注解@EnableTrasactionManagerServer 必须有。</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token doc-comment comment">/**
 * EnableTransactionManagerServer - 开启事务管理器服务端。（事务协调器）
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableTransactionManagerServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="5 访问管理界面" dir="auto" class="heading" id="5_访问管理界面"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5 访问管理界面</h3><div class="heading-children"><div><p dir="auto">在浏览器输入：<code>http://localhost:7970</code> 访问。<br>
密码默认是 <code>codingapi</code><br>
可以在配置文件中修改登录密码</p></div><div><pre dir="auto"><code>`tx-lcn.manager.admin-key=bjsxt` 

</code><button class="copy-code-button">复制</button></pre></div><div><p dir="auto"><span alt="65dc0a9079e0ac68f5fdc862a5bdfc61_MD5.png" src="65dc0a9079e0ac68f5fdc862a5bdfc61_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="65dc0a9079e0ac68f5fdc862a5bdfc61_MD5.png" src="attachments/65dc0a9079e0ac68f5fdc862a5bdfc61_md5.png" target="_self"></span></p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="七、 LCN 事务模式" dir="auto" class="heading" id="七、_LCN_事务模式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>七、 LCN 事务模式</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="1 创建数据库表" dir="auto" class="heading" id="1_创建数据库表"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 创建数据库表</h3><div class="heading-children"><div><p dir="auto">注意：不要给 student 表添加外键约束。如果添加会导致分布式事务执行时 student 新增失败，因为 teacher 没有提交时 student 的 tid 值无法获取。<br>
<span alt="f84ee5944e184fd8b04ad28d41db3481_MD5.png" src="f84ee5944e184fd8b04ad28d41db3481_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="f84ee5944e184fd8b04ad28d41db3481_MD5.png" src="attachments/f84ee5944e184fd8b04ad28d41db3481_md5.png" target="_self"></span></p></div></div></div><div class="heading-wrapper"><h3 data-heading="2 创建项目" dir="auto" class="heading" id="2_创建项目"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 创建项目</h3><div class="heading-children"><div><p dir="auto">案例使用聚合项目进行演示。<br>
创建父项目，名称为 LcnParent</p></div><div class="heading-wrapper"><h4 data-heading="2.1配置 pom.xml" dir="auto" class="heading" id="2.1配置_pom.xml"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1配置 pom.xml</h4><div class="heading-children"><div><p dir="auto">txlcn-tc 是 TX-LCN 的客户端包<br>
txlcn-txmsg-netty 是 LCN 客户端连接 TxManager 需要的包</p></div><div><pre dir="auto" class="language-xml" tabindex="0"><code class="language-xml is-loaded">`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.48<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.codingapi.txlcn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>txlcn-tc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.0.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.codingapi.txlcn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>txlcn-txmsg-netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.0.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>Hoxton.SR4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="3 新建 pojo 项目" dir="auto" class="heading" id="3_新建_pojo_项目"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3 新建 pojo 项目</h3><div class="heading-children"><div><p dir="auto">把实体类提出了<br>
新建两个实体类。<br>
新建 com.bjsxt.pojo.Teacher</p></div><div><pre dir="auto"><code>`@Data
public class Teacher {
	private Long id;
	private String name;
}` 

</code><button class="copy-code-button">复制</button></pre></div><div><p dir="auto">新建 com.bjsxt.pojo.Student</p></div><div><pre dir="auto"><code>`@Data
public class Student {
	private Long id;
	private String name;
	private Long tid;
}` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="4 创建项目 teacher_insert" dir="auto" class="heading" id="4_创建项目_teacher_insert"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4 创建项目 teacher_insert</h3><div class="heading-children"><div><p dir="auto">新建 teacher_insert 项目</p></div><div class="heading-wrapper"><h4 data-heading="4.1配置 pom.xml" dir="auto" class="heading" id="4.1配置_pom.xml"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.1配置 pom.xml</h4><div class="heading-children"><div><p dir="auto">依赖 pojo</p></div><div><pre dir="auto" class="language-xml" tabindex="0"><code class="language-xml is-loaded">`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pojo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.bjsxt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="4.2编写配置文件" dir="auto" class="heading" id="4.2编写配置文件"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.2编写配置文件</h4><div class="heading-children"><div><p dir="auto">新建 application.yml. 数据源连接的是 Teacher 表所在数据库 eureka 单机版可以省略。<br>
manager-address 配置 TxManager 项目的 ip 及端口。端口是内部访问端口，而不是可视化页面的端口。</p></div><div><pre dir="auto" class="language-yml" tabindex="0"><code class="language-yml is-loaded">`spring<span class="token punctuation">:</span>
	<span class="token key atrule">datasource</span><span class="token punctuation">:</span>
		<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/microservice
		<span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
		<span class="token key atrule">username</span><span class="token punctuation">:</span> root
		<span class="token key atrule">password</span><span class="token punctuation">:</span> root
	<span class="token key atrule">application</span><span class="token punctuation">:</span>
		<span class="token key atrule">name</span><span class="token punctuation">:</span> teacher<span class="token punctuation">-</span>insert
<span class="token key atrule">server</span><span class="token punctuation">:</span>
	<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
	<span class="token key atrule">client</span><span class="token punctuation">:</span>
		<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
			<span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka/
<span class="token key atrule">tx-lcn</span><span class="token punctuation">:</span>
	<span class="token key atrule">client</span><span class="token punctuation">:</span>
		<span class="token key atrule">manager-address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span>8070` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="4.3新建 mapper" dir="auto" class="heading" id="4.3新建_mapper"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.3新建 mapper</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.mapper.TeacherMapper</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TeacherMapper</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into teacher values(#{id},#{name})"</span><span class="token punctuation">)</span>
	<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="4.4新建 service 及实现类" dir="auto" class="heading" id="4.4新建_service_及实现类"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.4新建 service 及实现类</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.service.TeacherService 及实现类。方法上@Transactional 一定要有。本地事务控制。<br>
@LcnTransaction 表示当前方法加入到分布式事务控制。<br>
@LcnTransaction 属性 propagation 可取值DTXPropagation.REQUIRED：默认值，表示如果当前没有事务组创建事务组，如果有事务组，加入事务组。多用在事务发起方。<br>
DTXPropagation.SUPPORTS：如果当前没有事务组以本地事务运行，如果当前有事务组加入事务组。多用在事务参与方法。</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TeacherService</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TeacherService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TeacherMapper</span> teacherMapper<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@LcnTransaction</span>
	<span class="token annotation punctuation">@Transactional</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> teacherMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 


</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="4.5新建控制器" dir="auto" class="heading" id="4.5新建控制器"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.5新建控制器</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.controller.TeacherController。<br>
由于在 student_insert 中通过 OpenFeign 进行条件，参数使用请求体数据，所以控制器方法的参数需要添加@RequestBody</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherController</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TeacherService</span> teacherService<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/insert"</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ResponseBody</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"taecher"</span><span class="token operator">+</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> teacherService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="4.6新建启动器" dir="auto" class="heading" id="4.6新建启动器"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.6新建启动器</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.TeacherInsertApplication。<br>
一定要有注解@EnableDistributedTransaction 表示启动分布式事务</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDistributedTransaction</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherInsertApplication</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TeacherInsertApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="5 新建项目 student_insert" dir="auto" class="heading" id="5_新建项目_student_insert"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5 新建项目 student_insert</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="5.1编写 pom.xml" dir="auto" class="heading" id="5.1编写_pom.xml"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.1编写 pom.xml</h4><div class="heading-children"><div><p dir="auto">添加对 pojo 依赖</p></div><div><pre dir="auto" class="language-xml" tabindex="0"><code class="language-xml is-loaded">`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pojo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.bjsxt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="5.2创建配置文件" dir="auto" class="heading" id="5.2创建配置文件"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.2创建配置文件</h4><div class="heading-children"><div><p dir="auto">新建 application.yml</p></div><div><pre dir="auto" class="language-yml" tabindex="0"><code class="language-yml is-loaded">`spring<span class="token punctuation">:</span>
	<span class="token key atrule">datasource</span><span class="token punctuation">:</span>
		<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/microservice
		<span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
		<span class="token key atrule">username</span><span class="token punctuation">:</span> root
		<span class="token key atrule">password</span><span class="token punctuation">:</span> root
	<span class="token key atrule">application</span><span class="token punctuation">:</span>
		<span class="token key atrule">name</span><span class="token punctuation">:</span> student<span class="token punctuation">-</span>insert
<span class="token key atrule">server</span><span class="token punctuation">:</span>
	<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
	<span class="token key atrule">client</span><span class="token punctuation">:</span>
		<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
			<span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka/
<span class="token key atrule">tx-lcn</span><span class="token punctuation">:</span>
	<span class="token key atrule">client</span><span class="token punctuation">:</span>
		<span class="token key atrule">manager-address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span>807` 


</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="5.3新建 Feign 接口" dir="auto" class="heading" id="5.3新建_Feign_接口"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.3新建 Feign 接口</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.feign.TeacherInsertFeign</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"teacher-insert"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TeacherInsertFeign</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/insert"</span><span class="token punctuation">)</span>
	<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Teacher</span> teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 


</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="5.4新建 Mapper" dir="auto" class="heading" id="5.4新建_Mapper"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.4新建 Mapper</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.mapper.StudentMapper</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentMapper</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into student values(#{id},#{name},#{tid})"</span><span class="token punctuation">)</span>
	<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="5.5新建 service 及实现类" dir="auto" class="heading" id="5.5新建_service_及实现类"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.5新建 service 及实现类</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.service.StudentService。<br>
实现类中对 Teacher 和 Student 的主键都是随机数，为了测试时多次测试方便，所以没有给固定值。Student 的姓名通过客户端请求参数传递的，其他都不需要通过参数设置。</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentService</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 


</code><button class="copy-code-button">复制</button></pre></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StudentService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">StudentMapper</span> studentMapper<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TeacherInsertFeign</span> teacherInsertFeign<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@LcnTransaction</span>
	<span class="token annotation punctuation">@Transactional</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Teacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		teacher<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		teacher<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"随意的名称"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setTid</span><span class="token punctuation">(</span>teacher<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		teacherInsertFeign<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> studentMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="5.6新建控制器" dir="auto" class="heading" id="5.6新建控制器"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.6新建控制器</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.controller.StudentController</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">StudentService</span> studentService<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/insert"</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ResponseBody</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> studentService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="5.7新建启动类" dir="auto" class="heading" id="5.7新建启动类"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.7新建启动类</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.StudentInsertApplication</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDistributedTransaction</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentInsertApplication</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">StudentInsertApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 


</code><button class="copy-code-button">复制</button></pre></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="6 测试结果" dir="auto" class="heading" id="6_测试结果"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>6 测试结果</h3><div class="heading-children"><div><p dir="auto">在浏览器中输入 <code>http://localhost:8081/insert?name=bjsxt</code> 后,如果页面显示 1 并且数据库teacher 表和 student 表各增加一条数据表示新增成功。<br>
为了测试分布式事务效果，在 student_insert 项目实现类方法 return 上面添加 <code>int i =5/0;</code>的算术异常，再次访问 url 页面会报 500，并且数据库中没有新增数据，说明分布式事务成功了。<br>
<span alt="8732a6587350cc0eb0eeb98f82d18d54_MD5.png" src="8732a6587350cc0eb0eeb98f82d18d54_MD5.png" class="internal-embed media-embed image-embed is-loaded"><img alt="8732a6587350cc0eb0eeb98f82d18d54_MD5.png" src="attachments/8732a6587350cc0eb0eeb98f82d18d54_md5.png" target="_self"></span></p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="八、 TCC 事务模式（多模式混合使用）" dir="auto" class="heading" id="八、_TCC_事务模式（多模式混合使用）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>八、 TCC 事务模式（多模式混合使用）</h2><div class="heading-children"><div><p dir="auto">在上面 LCN 事务模式代码基础上进行修改</p></div><div class="heading-wrapper"><h3 data-heading="1 新建项目 mongodb_insert" dir="auto" class="heading" id="1_新建项目_mongodb_insert"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1 新建项目 mongodb_insert</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="1.1修改 pom.xml" dir="auto" class="heading" id="1.1修改_pom.xml"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.1修改 pom.xml</h4><div class="heading-children"><div><p dir="auto">在当前项目中引入 mongodb 的依赖。如果在父项目中进行引入，则所有的子项目都需要配置 mongodb 的相关属性。</p></div><div><pre dir="auto" class="language-xml" tabindex="0"><code class="language-xml is-loaded">`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="1.2新建配置文件" dir="auto" class="heading" id="1.2新建配置文件"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.2新建配置文件</h4><div class="heading-children"><div><p dir="auto">新建 application.yml。<br>
虽然当前项目是连接 Mongodb 但是也需要配置 MySQL 数据源，因为 LCN 需要在 MySQL中记录异常信息等。<br>
配置文件中比别的项目多了 MongoDB 的配置。</p></div><div><pre dir="auto" class="language-yml" tabindex="0"><code class="language-yml is-loaded">`spring<span class="token punctuation">:</span>
	<span class="token key atrule">datasource</span><span class="token punctuation">:</span>
		<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/microservice
		<span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
		<span class="token key atrule">username</span><span class="token punctuation">:</span> root
		<span class="token key atrule">password</span><span class="token punctuation">:</span> root
	<span class="token key atrule">application</span><span class="token punctuation">:</span>
		<span class="token key atrule">name</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">-</span>insert
	<span class="token key atrule">data</span><span class="token punctuation">:</span>
		<span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
			<span class="token key atrule">authentication-database</span><span class="token punctuation">:</span> admin
			<span class="token key atrule">username</span><span class="token punctuation">:</span> bjsxt
			<span class="token key atrule">password</span><span class="token punctuation">:</span> bjsxtpwd
			<span class="token key atrule">database</span><span class="token punctuation">:</span> lcn
			<span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.8.1
			<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
	<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8082</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
	<span class="token key atrule">client</span><span class="token punctuation">:</span>
		<span class="token key atrule">service-url</span><span class="token punctuation">:</span>
			<span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka/
<span class="token key atrule">tx-lcn</span><span class="token punctuation">:</span>
	<span class="token key atrule">client</span><span class="token punctuation">:</span>
		<span class="token key atrule">manager-address</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span>8070` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="1.3新建实体类" dir="auto" class="heading" id="1.3新建实体类"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3新建实体类</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.pojo.People</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 
</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="1.4新建 service 及实现类" dir="auto" class="heading" id="1.4新建_service_及实现类"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.4新建 service 及实现类</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.service.PeopleService 及实现类。<br>
具有@TccTransaction 注解的方法有以下特性</p></div><div><ol dir="auto">
<li data-line="0" dir="auto">可以没有@Transactional</li>
<li data-line="1" dir="auto">如果整个分布式事务所有方法执行都没有异常，会回调名称为：<code>confirm+方法名</code><br>
首字母大写的方法。insert 方法的回调方法叫做 confirmInsert()。同时方法参数也可以传递给回调方法。</li>
<li data-line="3" dir="auto">只要整个分布式事务中有一个方法出现异常，会回调 cancel+方法名首字母大写的回调方法。需要在这个方法中编写事务回滚的业务。</li>
</ol></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@TccTransaction</span> 注解属性说明：
cancelMethod：明确指定失败的回调方法名
confirmMethod：明确指定成功的回调方法名` 

</code><button class="copy-code-button">复制</button></pre></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PeopleService</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">People</span> people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 


</code><button class="copy-code-button">复制</button></pre></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PeopleServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PeopleService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@TccTransaction</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">People</span> people<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">People</span> result <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancelInsert</span><span class="token punctuation">(</span><span class="token class-name">People</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行了 cancel 方法"</span><span class="token operator">+</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mongoTemplate<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"所谓的事务回滚就是删除新增的数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirmInsert</span><span class="token punctuation">(</span><span class="token class-name">People</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行了 confirm 方法"</span><span class="token operator">+</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 



</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="1.5新建控制器" dir="auto" class="heading" id="1.5新建控制器"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.5新建控制器</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.controller.PeopleController</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PeopleController</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">PeopleService</span> peopleService<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/insert"</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ResponseBody</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">People</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> peopleService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="1.6测试" dir="auto" class="heading" id="1.6测试"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.6测试</h4><div class="heading-children"><div><p dir="auto">在浏览器输入 <code>http://localhost:8082/insert?name=sxt</code> 观察 mongodb 中是否出现了 lcn 的数据库，数据库中是否出现 People 的集合，people 集合中 name 属性值为sxt</p></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="2 修改 student_insert" dir="auto" class="heading" id="2_修改_student_insert"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2 修改 student_insert</h3><div class="heading-children"><div class="heading-wrapper"><h4 data-heading="2.1新建 feign 接口" dir="auto" class="heading" id="2.1新建_feign_接口"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1新建 feign 接口</h4><div class="heading-children"><div><p dir="auto">新建 com.bjsxt.feign.MongodbInsertFeign。<br>
为了传递普通表单数据，<a data-tooltip-position="top" aria-label="https://so.csdn.net/so/search?q=insert&amp;spm=1001.2101.3001.7020" rel="noopener" class="external-link is-unresolved" href="https://so.csdn.net/so/search?q=insert&amp;spm=1001.2101.3001.7020" target="_self">insert</a> 方法参数由@RequestParam。mongodb_insert 控制器方法参数就可以使用 String name 或 People 进行接收。</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded">`<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"mongodb-insert"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MongodbInsertFeign</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/insert"</span><span class="token punctuation">)</span>
	<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>` 

</code><button class="copy-code-button">复制</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="2.2修改 service 实现类" dir="auto" class="heading" id="2.2修改_service_实现类"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2修改 service 实现类</h4><div class="heading-children"><div><p dir="auto">修改 com.bjsxt.service.impl.StudentServiceImpl。<br>
在实现类中调用 feign 接口的方法。<br>
当前方法依然使用 LCN 事务模式。方法上面加什么事务模式注解只考虑当前方法本地事务，不考虑调用远程方法的事务。如果当前方法中没有本地事务，全是调用远程方法，那么当前方法使用 LCN 或 TCC 事务模式都可以，但是必须要有事务模式，因为如果没有注解就不会想 TxManager 中创建事务组。</p></div><div><pre dir="auto" class="language-java" tabindex="0"><code class="language-java is-loaded"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StudentService</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">StudentMapper</span> studentMapper<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">TeacherInsertFeign</span> teacherInsertFeign<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">MongodbInsertFeign</span> mongodbInsertFeign<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@LcnTransaction</span>
	<span class="token annotation punctuation">@Transactional</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Teacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		teacher<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		teacher<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"随意的名称"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setTid</span><span class="token punctuation">(</span>teacher<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		student<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span> 
		teacherInsertFeign<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mongodbInsertFeign<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"随意的名称"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// int i = 5/0;</span>
		<span class="token keyword">return</span> studentMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code><button class="copy-code-button">复制</button></pre></div><div><p dir="auto">练习源码：<a rel="noopener" class="external-link is-unresolved" href="https://gitee.com/cutelili/tx-lcn" target="_self">https://gitee.com/cutelili/tx-lcn</a></p></div><div class="mod-footer"></div></div></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="outline-tree tree-container"><div class="tree-item nav-folder mod-root" data-depth="0"><div class="tree-item-self nav-folder-title"><div class="tree-item-inner nav-folder-title-content">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all is-collapsed" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item-children nav-folder-children"><div class="nav-folder-spacer"></div><div class="tree-item is-collapsed" data-depth="1"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#分布式事务处理【TX-LCN】" data-path="#分布式事务处理【TX-LCN】"><div class="tree-item-inner heading-link" heading-name="分布式事务处理【TX-LCN】">分布式事务处理【TX-LCN】</div></a><div class="tree-item-children"><div class="tree-item is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#[分布式事务](https//so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020)框架_TX-LCN" data-path="#[分布式事务](https//so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020)框架_TX-LCN"><div class="tree-item-inner heading-link" heading-name="[分布式事务](https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020)框架 TX-LCN"><span>分布式事务</span>框架 TX-LCN</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#一、_分布式事务" data-path="#一、_分布式事务"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="一、 分布式事务">一、 分布式事务</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_分布式事务是什么？" data-path="#1_分布式事务是什么？"><div class="tree-item-inner heading-link" heading-name="1 分布式事务是什么？">1 分布式事务是什么？</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_什么时候使用假冒业务" data-path="#2_什么时候使用假冒业务"><div class="tree-item-inner heading-link" heading-name="2 什么时候使用假冒业务">2 什么时候使用假冒业务</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3_分布式事务常见解决方案" data-path="#3_分布式事务常见解决方案"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3 分布式事务常见解决方案">3 分布式事务常见解决方案</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3.1基于_XA_协议的两阶段提交" data-path="#3.1基于_XA_协议的两阶段提交"><div class="tree-item-inner heading-link" heading-name="3.1基于 XA 协议的两阶段提交">3.1基于 XA 协议的两阶段提交</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3.2消息事务+最终一致性" data-path="#3.2消息事务+最终一致性"><div class="tree-item-inner heading-link" heading-name="3.2消息事务+最终一致性">3.2消息事务+最终一致性</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#二、_分布式事务理论依据" data-path="#二、_分布式事务理论依据"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="二、 分布式事务理论依据">二、 分布式事务理论依据</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_CAP_定理" data-path="#1_CAP_定理"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="1 CAP 定理">1 CAP 定理</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.1一致性（C）" data-path="#1.1一致性（C）"><div class="tree-item-inner heading-link" heading-name="1.1一致性（C）">1.1一致性（C）</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.2可用性（A）" data-path="#1.2可用性（A）"><div class="tree-item-inner heading-link" heading-name="1.2可用性（A）">1.2可用性（A）</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.3分区容错性（P）" data-path="#1.3分区容错性（P）"><div class="tree-item-inner heading-link" heading-name="1.3分区容错性（P）">1.3分区容错性（P）</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_BASE_理论" data-path="#2_BASE_理论"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="2 BASE 理论">2 BASE 理论</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1基本可用（BA）" data-path="#2.1基本可用（BA）"><div class="tree-item-inner heading-link" heading-name="2.1基本可用（BA）">2.1基本可用（BA）</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.2软状态（S）" data-path="#2.2软状态（S）"><div class="tree-item-inner heading-link" heading-name="2.2软状态（S）">2.2软状态（S）</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.3最终一致性" data-path="#2.3最终一致性"><div class="tree-item-inner heading-link" heading-name="2.3最终一致性">2.3最终一致性</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#三、_TX-LCN_概述" data-path="#三、_TX-LCN_概述"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="三、 TX-LCN 概述">三、 TX-LCN 概述</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_简介" data-path="#1_简介"><div class="tree-item-inner heading-link" heading-name="1 简介">1 简介</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_TX-LCN_原理" data-path="#2_TX-LCN_原理"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="2 TX-LCN 原理">2 TX-LCN 原理</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item mod-collapsible is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1原理中核心内容" data-path="#2.1原理中核心内容"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="2.1原理中核心内容">2.1原理中核心内容</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="5"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1.1_创建事务组" data-path="#2.1.1_创建事务组"><div class="tree-item-inner heading-link" heading-name="2.1.1 创建事务组">2.1.1 创建事务组</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="5"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1.2_加入事务组" data-path="#2.1.2_加入事务组"><div class="tree-item-inner heading-link" heading-name="2.1.2 加入事务组">2.1.2 加入事务组</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="5"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1.3_通知事务组" data-path="#2.1.3_通知事务组"><div class="tree-item-inner heading-link" heading-name="2.1.3 通知事务组">2.1.3 通知事务组</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#四、_TX-LCN_事务模式" data-path="#四、_TX-LCN_事务模式"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="四、 TX-LCN 事务模式">四、 TX-LCN 事务模式</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_LCN_模式" data-path="#1_LCN_模式"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="1 LCN 模式">1 LCN 模式</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.1原理介绍" data-path="#1.1原理介绍"><div class="tree-item-inner heading-link" heading-name="1.1原理介绍">1.1原理介绍</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.2模式特点" data-path="#1.2模式特点"><div class="tree-item-inner heading-link" heading-name="1.2模式特点">1.2模式特点</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_TCC_事务模式" data-path="#2_TCC_事务模式"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="2 TCC 事务模式">2 TCC 事务模式</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1原理介绍" data-path="#2.1原理介绍"><div class="tree-item-inner heading-link" heading-name="2.1原理介绍">2.1原理介绍</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.2代码说明" data-path="#2.2代码说明"><div class="tree-item-inner heading-link" heading-name="2.2代码说明">2.2代码说明</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.3模式特点" data-path="#2.3模式特点"><div class="tree-item-inner heading-link" heading-name="2.3模式特点">2.3模式特点</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3_TXC_事务模式" data-path="#3_TXC_事务模式"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="3 TXC 事务模式">3 TXC 事务模式</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3.1原理介绍" data-path="#3.1原理介绍"><div class="tree-item-inner heading-link" heading-name="3.1原理介绍">3.1原理介绍</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3.2模式特点" data-path="#3.2模式特点"><div class="tree-item-inner heading-link" heading-name="3.2模式特点">3.2模式特点</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#五、_XA_的两阶段提交方案（数据库支持分布式事务，为什么还用TX-LCN）" data-path="#五、_XA_的两阶段提交方案（数据库支持分布式事务，为什么还用TX-LCN）"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="五、 XA 的两阶段提交方案（数据库支持分布式事务，为什么还用TX-LCN）">五、 XA 的两阶段提交方案（数据库支持分布式事务，为什么还用TX-LCN）</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_什么是_XA_协议" data-path="#1_什么是_XA_协议"><div class="tree-item-inner heading-link" heading-name="1 什么是 XA 协议">1 什么是 XA 协议</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_XA_协议的一阶段提交" data-path="#2_XA_协议的一阶段提交"><div class="tree-item-inner heading-link" heading-name="2 XA 协议的一阶段提交">2 XA 协议的一阶段提交</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3_XA_协议的二阶段提交" data-path="#3_XA_协议的二阶段提交"><div class="tree-item-inner heading-link" heading-name="3 XA 协议的二阶段提交">3 XA 协议的二阶段提交</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#六、_TxManager_搭建" data-path="#六、_TxManager_搭建"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="六、 TxManager 搭建">六、 TxManager 搭建</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_创建项目，添加依赖" data-path="#1_创建项目，添加依赖"><div class="tree-item-inner heading-link" heading-name="1 创建项目，添加依赖">1 创建项目，添加依赖</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_执行_SQL_文件" data-path="#2_执行_SQL_文件"><div class="tree-item-inner heading-link" heading-name="2 执行 SQL 文件">2 执行 SQL 文件</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3_配置配置文件" data-path="#3_配置配置文件"><div class="tree-item-inner heading-link" heading-name="3 配置配置文件">3 配置配置文件</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4_新建启动类" data-path="#4_新建启动类"><div class="tree-item-inner heading-link" heading-name="4 新建启动类">4 新建启动类</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5_访问管理界面" data-path="#5_访问管理界面"><div class="tree-item-inner heading-link" heading-name="5 访问管理界面">5 访问管理界面</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#七、_LCN_事务模式" data-path="#七、_LCN_事务模式"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="七、 LCN 事务模式">七、 LCN 事务模式</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_创建数据库表" data-path="#1_创建数据库表"><div class="tree-item-inner heading-link" heading-name="1 创建数据库表">1 创建数据库表</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_创建项目" data-path="#2_创建项目"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="2 创建项目">2 创建项目</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1配置_pom.xml" data-path="#2.1配置_pom.xml"><div class="tree-item-inner heading-link" heading-name="2.1配置 pom.xml">2.1配置 pom.xml</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#3_新建_pojo_项目" data-path="#3_新建_pojo_项目"><div class="tree-item-inner heading-link" heading-name="3 新建 pojo 项目">3 新建 pojo 项目</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4_创建项目_teacher_insert" data-path="#4_创建项目_teacher_insert"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="4 创建项目 teacher_insert">4 创建项目 teacher_insert</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4.1配置_pom.xml" data-path="#4.1配置_pom.xml"><div class="tree-item-inner heading-link" heading-name="4.1配置 pom.xml">4.1配置 pom.xml</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4.2编写配置文件" data-path="#4.2编写配置文件"><div class="tree-item-inner heading-link" heading-name="4.2编写配置文件">4.2编写配置文件</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4.3新建_mapper" data-path="#4.3新建_mapper"><div class="tree-item-inner heading-link" heading-name="4.3新建 mapper">4.3新建 mapper</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4.4新建_service_及实现类" data-path="#4.4新建_service_及实现类"><div class="tree-item-inner heading-link" heading-name="4.4新建 service 及实现类">4.4新建 service 及实现类</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4.5新建控制器" data-path="#4.5新建控制器"><div class="tree-item-inner heading-link" heading-name="4.5新建控制器">4.5新建控制器</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#4.6新建启动器" data-path="#4.6新建启动器"><div class="tree-item-inner heading-link" heading-name="4.6新建启动器">4.6新建启动器</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5_新建项目_student_insert" data-path="#5_新建项目_student_insert"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="5 新建项目 student_insert">5 新建项目 student_insert</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5.1编写_pom.xml" data-path="#5.1编写_pom.xml"><div class="tree-item-inner heading-link" heading-name="5.1编写 pom.xml">5.1编写 pom.xml</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5.2创建配置文件" data-path="#5.2创建配置文件"><div class="tree-item-inner heading-link" heading-name="5.2创建配置文件">5.2创建配置文件</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5.3新建_Feign_接口" data-path="#5.3新建_Feign_接口"><div class="tree-item-inner heading-link" heading-name="5.3新建 Feign 接口">5.3新建 Feign 接口</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5.4新建_Mapper" data-path="#5.4新建_Mapper"><div class="tree-item-inner heading-link" heading-name="5.4新建 Mapper">5.4新建 Mapper</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5.5新建_service_及实现类" data-path="#5.5新建_service_及实现类"><div class="tree-item-inner heading-link" heading-name="5.5新建 service 及实现类">5.5新建 service 及实现类</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5.6新建控制器" data-path="#5.6新建控制器"><div class="tree-item-inner heading-link" heading-name="5.6新建控制器">5.6新建控制器</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#5.7新建启动类" data-path="#5.7新建启动类"><div class="tree-item-inner heading-link" heading-name="5.7新建启动类">5.7新建启动类</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#6_测试结果" data-path="#6_测试结果"><div class="tree-item-inner heading-link" heading-name="6 测试结果">6 测试结果</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#八、_TCC_事务模式（多模式混合使用）" data-path="#八、_TCC_事务模式（多模式混合使用）"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="八、 TCC 事务模式（多模式混合使用）">八、 TCC 事务模式（多模式混合使用）</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1_新建项目_mongodb_insert" data-path="#1_新建项目_mongodb_insert"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="1 新建项目 mongodb_insert">1 新建项目 mongodb_insert</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.1修改_pom.xml" data-path="#1.1修改_pom.xml"><div class="tree-item-inner heading-link" heading-name="1.1修改 pom.xml">1.1修改 pom.xml</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.2新建配置文件" data-path="#1.2新建配置文件"><div class="tree-item-inner heading-link" heading-name="1.2新建配置文件">1.2新建配置文件</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.3新建实体类" data-path="#1.3新建实体类"><div class="tree-item-inner heading-link" heading-name="1.3新建实体类">1.3新建实体类</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.4新建_service_及实现类" data-path="#1.4新建_service_及实现类"><div class="tree-item-inner heading-link" heading-name="1.4新建 service 及实现类">1.4新建 service 及实现类</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.5新建控制器" data-path="#1.5新建控制器"><div class="tree-item-inner heading-link" heading-name="1.5新建控制器">1.5新建控制器</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#1.6测试" data-path="#1.6测试"><div class="tree-item-inner heading-link" heading-name="1.6测试">1.6测试</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible is-collapsed" data-depth="3"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2_修改_student_insert" data-path="#2_修改_student_insert"><div class="tree-item-icon collapse-icon is-collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="2 修改 student_insert">2 修改 student_insert</div></a><div class="tree-item-children" style="display: none;"><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.1新建_feign_接口" data-path="#2.1新建_feign_接口"><div class="tree-item-inner heading-link" heading-name="2.1新建 feign 接口">2.1新建 feign 接口</div></a><div class="tree-item-children"></div></div><div class="tree-item is-collapsed" data-depth="4"><a class="tree-item-self is-clickable" href="知识库/工作技能/分布式/分布式事务架构/分布式事务处理【tx-lcn】.html#2.2修改_service_实现类" data-path="#2.2修改_service_实现类"><div class="tree-item-inner heading-link" heading-name="2.2修改 service 实现类">2.2修改 service 实现类</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>